language: node_js
node_js:
- '7'
notifications:
  email: false
  webhooks:
    urls:
    - https://server.tyratox.ch/webhooks/travis/
    on_success: always
    on_failure: always
    on_start: never
    on_cancel: never
    on_error: always
env:
  global:
    - CM_MESSAGE="Automated travis build"
    secure: "1Au6xOmSlorykJ4T+MtLPGved2zcJU4nWpC1RmkiE6NEqgaDNz/KagdJGWASnoqmiAt4j6il7OWc5doXsJPCJaKPY36B2DjwvQJrmBIsaZ1poFaLYR2MJ2MeLCIT+tlcQOuTm/MNRecuBLb7weTkCnFbJPrgtmGDipo3zxAmYF84P8AuJEH8inp5eYviVrfzNJ3ek0PaMoHce10NlGctk0XsqU8AMDf5Ui14oTmQQmMrQJua1kMQW5FC6mW4Qqy1GEDV6uHbTpr4XjY+6YqHEyaDbvd1JZLheqh1aREPkFBb+wm8w8FVUxgLwcDMPuoJq02keV9BZBQLsbvISNIC4n9fij5gN+71u9E85x3yGrau6lh3WPvzUH/q8s3Z5QVJsVhMbi5sqfI6mfqYPCkbvQ8gkkkqO8C3GZQckLIKx1GDtpw32qvN2zfoqyca4Ab+F4DmwACiWLXTFplu0dE8QpbvbrQ3JpDEWn3tC+XvP7VmpzXthfkRGasZOcOp3e+mHIs1ylVvhG4NwKxJ4cIHy0XK8VO5Ga4Jd3g55rO4I50VNUaWffYbXZHXYOKkwIwtxK5U1R4FmbnXA6XzHwRWejgWR/oy56RrvP+GwQBYa4o1RDaP7yEsLFC9091Irv20mGKEDVEB1fUmdV1o2svFECdEUXOjVO/QTNMy+f+UmnE="
branches:
  except:
  - "/^build-[0-9A-z\\-]*/"
before_install:
  - if [ "$TRAVIS_COMMIT_MESSAGE" = "$CM_MESSAGE"]; then travis cancel; fi
install:
- yarn install
before_script:
- if [ "$TRAVIS_PULL_REQUEST" = "false" ] && [ "$TRAVIS_BRANCH" == "release" ]; then
  echo "{\"API_URL:\":\"https://api.booki.me\", \"API_VERSION:\":\"1\", \"CLIENT_ID:\":\"2\",
  \"REDIRECT_URI:\":\"https://booki.me/oauth-callback\"}" > config.json; fi
- if [ "$TRAVIS_PULL_REQUEST" = "false" ] && [ "$TRAVIS_BRANCH" == "master" ]; then
  echo "{\"API_URL:\":\"https://beta-api.booki.me\", \"API_VERSION:\":\"1\", \"CLIENT_ID:\":\"2\",
  \"REDIRECT_URI:\":\"https://beta.booki.me/oauth-callback\"}" > config.json; fi
- if [ "$TRAVIS_PULL_REQUEST" = "false" ] && [ "$TRAVIS_BRANCH" == "dev" ]; then echo
  "{\"API_URL:\":\"https://dev-api.booki.me\", \"API_VERSION:\":\"1\", \"CLIENT_ID:\":\"2\",
  \"REDIRECT_URI:\":\"https://dev.booki.me/oauth-callback\"}" > config.json; fi
- yarn test
script:
- yarn run build
after_success:
- cd build && ls -la
- export GIT_TAG=build-$TRAVIS_BRANCH-$(date -u "+%Y-%m-%d")-$TRAVIS_BUILD_NUMBER
- git remote add origin-frontend https://${GH_TOKEN}@github.com/hexcodech/booki-frontend.git > /dev/null 2>&1
- git config --global user.email "travis@travis-ci.org"
- git config --global user.name "Travis CI"
- git config --global push.default simple
- git add -A .
- git commit -m "$CM_MESSAGE"
- if [ "$TRAVIS_PULL_REQUEST" = "false" ] && [ "$TRAVIS_BRANCH" == "release" ]; then
    git tag $GIT_TAG -a -m "Generated tag from Travis CI build $TRAVIS_BUILD_NUMBER";
    git push --quiet origin-frontend HEAD:$TRAVIS_BRANCH $GIT_TAG > /dev/null 2>&1;
  else
    git push --quiet origin-frontend HEAD:$TRAVIS_BRANCH > /dev/null 2>&1;
  fi
