language: node_js
node_js:
  - "node"
  - "7"
notifications:
  email: false
  webhooks:
    urls:
    - https://server.tyratox.ch/webhooks/travis/
    on_success: always
    on_failure: always
    on_start: never
    on_cancel: always
    on_error: always
install:
  - yarn install
before_script:
  - if [ "$TRAVIS_PULL_REQUEST" = "false" ] && [ "$TRAVIS_BRANCH" == "release" ]; then
      echo "{\"API_URL:\":\"https://api.booki.me\", \"API_VERSION:\":\"1\", \"CLIENT_ID:\":\"2\", \"REDIRECT_URI:\":\"https://booki.me/oauth-callback\"}" > config.json;
    fi
  - if [ "$TRAVIS_PULL_REQUEST" = "false" ] && [ "$TRAVIS_BRANCH" == "master" ]; then
      echo "{\"API_URL:\":\"https://beta-api.booki.me\", \"API_VERSION:\":\"1\", \"CLIENT_ID:\":\"2\", \"REDIRECT_URI:\":\"https://beta.booki.me/oauth-callback\"}" > config.json;
    fi
  - if [ "$TRAVIS_PULL_REQUEST" = "false" ] && [ "$TRAVIS_BRANCH" == "dev" ]; then
      echo "{\"API_URL:\":\"https://dev-api.booki.me\", \"API_VERSION:\":\"1\", \"CLIENT_ID:\":\"2\", \"REDIRECT_URI:\":\"https://dev.booki.me/oauth-callback\"}" > config.json;
    fi
  - yarn test
script:
  - yarn run build
after_success:
  - cd build && zip booki-frontend *
deploy:
  provider: releases
  api_key:
    secure: GGx2Yqju7BHBtS53kC12Ki1+ZRkmJRZKz1O9YMcpgveKV9U9mcUBxsdbqQWg+UB5wi/XyzQDsNSuIoj9wgnTih5UD7+0FnOlwdhBOHaoPKPg6YmKcQUaTIwSobRpaKG50AR/9dz79V1MBquBSFhsjwoXZ2jbSTrHeilvVl50sAMM+0Rb+y3ZaMOkieLdS9acVhBip165FOu5e7k+NDVmOJ8wY6i/85GRJ7n07CfZAgvBLYJKoG06JpHmaynKS4/n1yadHGQfVvuAlRT2EsNleJ5BspYY+9+jfH4YOFx+m6DYGGPk8i0E8/g96s747o4kbyDpKkSC9bY7d/CxiT2cFlyKPgsgob4PXLf/iaRur3FU2499rLMV8hBKoVecBYciyfGLUWmarquIZDe0GGQTyZsdvk3+WKor2IH6qxx5/1T40cKT8vsimPdCbpMwV5bAh/etQqzxwVbKcU0KAB9F19s858GWUstSNbqfxF4OCvQl5hR/et/oXXRcPlcMoOe64z+VFmnQJuxLeQmL2yrW2WUtBfFTDJLniAS5zH5l7PhoMaTD7jlIFSJjOasmhQ3zTeHwlXhrgZWQK7OUCaw9spEc2IV6TY4No+9FQ2IODhE2rbwZE+cvBAzKYg4E4G+9mVk2nZTEgtWSiIOImDjLKHT5u6RLuZHoGo29s5+hkWk=
  file: build/booki-frontend.zip
  on:
    repo: hexcodech/booki-frontend
