language: node_js
node_js:
- '7'
notifications:
  email: false
  webhooks:
    urls:
    - https://server.tyratox.ch/webhooks/travis/
    on_success: always
    on_failure: always
    on_start: never
    on_cancel: always
    on_error: always
env:
  global:
    secure: T1ihFlo4unh8ivr/EQz7KcWiUNmk0176wUvUgspYDGci/LMyfp6O9NWX5e1u+TFnIV1Zh8s5Ig7W7JYwZD6Pwmy4EIua0qnJRCx/BFUJmhq9BcrIN8kKbjlPHo5KGlvw07B/v/tWXhR1kex8ef1867NkNFmfPpysa7ZH1ZrdsPRXqRInaXCZ7FRU7h0GXF9QImJfhKSfJ2ZrDViSBAbUZMyZuZ7G6i9UMDURyPb4+Z3VqX6xgHeVP3jtxWiir2VJ9sSnQSa5CRIxZU3w0ShC2GlBWClXhdM6Jl5UVv3EzwYVgzb0XPAac5XHEp2P5tmPqkNG5qNzVHEftmvZMwIJKgI596ScivSkOhv0xPdizm9BDHgh0GBoeptuA4r+6Rj3sB8LyVzpoAyo4fMMo+PN6pr6J/mRdjOwlKEgHD69QaKnblzsp2z8LZi0vwNfhlam0zpsxwA6iSYJp4NeMHj3Irt1nUnHdMfYVXsnORJgwAUaCUaLfB9/D3E1zJ7cpyQ2ftD7OxhXujU64zb8zC6gAmkk7Fg8QYpPMEUOsTEPliwBLGcIwQ8BGwMSwTnp0N2kV7JJTWb0ZGhV0H9xcY2p6YZMVyeLbKKZ3SRjuuUpvdmCnMaFgk/qk6xEbDAOH59REq/HVfUTB2FIhJ/ici7txMbQGEccUJPdI207Rte5Y3Q=
branches:
  except:
  - "/^build-[0-9A-z\\-]*/"
install:
- yarn install
before_script:
- if [ "$TRAVIS_PULL_REQUEST" = "false" ] && [ "$TRAVIS_BRANCH" == "release" ]; then
  echo "{\"API_URL:\":\"https://api.booki.me\", \"API_VERSION:\":\"1\", \"CLIENT_ID:\":\"2\",
  \"REDIRECT_URI:\":\"https://booki.me/oauth-callback\"}" > config.json; fi
- if [ "$TRAVIS_PULL_REQUEST" = "false" ] && [ "$TRAVIS_BRANCH" == "master" ]; then
  echo "{\"API_URL:\":\"https://beta-api.booki.me\", \"API_VERSION:\":\"1\", \"CLIENT_ID:\":\"2\",
  \"REDIRECT_URI:\":\"https://beta.booki.me/oauth-callback\"}" > config.json; fi
- if [ "$TRAVIS_PULL_REQUEST" = "false" ] && [ "$TRAVIS_BRANCH" == "dev" ]; then echo
  "{\"API_URL:\":\"https://dev-api.booki.me\", \"API_VERSION:\":\"1\", \"CLIENT_ID:\":\"2\",
  \"REDIRECT_URI:\":\"https://dev.booki.me/oauth-callback\"}" > config.json; fi
- yarn test
script:
- yarn run build
after_success:
- cd build && ls -la
- if [ "$TRAVIS_PULL_REQUEST" = "false" ] && [ "$TRAVIS_BRANCH" == "release" ]; then
  export GIT_TAG=build-release-$TRAVIS_BRANCH-$(date -u "+%Y-%m-%d")-$TRAVIS_BUILD_NUMBER
  git config --global user.email "builds@travis-ci.com";
  git config --global user.name "Travis CI";
  echo -n $GIT_TAG > public/version;
  git commit -m "Set build VERSION number" public/version;
  git tag $GIT_TAG -a -m "Generated tag from Travis CI build $TRAVIS_BUILD_NUMBER";
  git push --quiet https://$GH_TOKEN@github.com/hexcodech/booki-frontend $GIT_TAG > /dev/null 2>&1;
  fi
- if [ "$TRAVIS_PULL_REQUEST" = "false" ] && [ "$TRAVIS_BRANCH" == "master" ]; then
  export GIT_TAG=build-staging-$TRAVIS_BRANCH-$(date -u "+%Y-%m-%d")-$TRAVIS_BUILD_NUMBER;
  git config --global user.email "builds@travis-ci.com";
  git config --global user.name "Travis CI"; git commit -a -m "Built files";
  git push --quiet https://$GH_TOKEN@github.com/hexcodech/booki-frontend > /dev/null 2>&1;
  fi
- if [ "$TRAVIS_PULL_REQUEST" = "false" ] && [ "$TRAVIS_BRANCH" == "dev" ]; then
  exportGIT_TAG=build-dev-$TRAVIS_BRANCH-$(date -u "+%Y-%m-%d")-$TRAVIS_BUILD_NUMBER;
  git config --global user.email "builds@travis-ci.com";
  git config --global user.name "Travis CI";
  git commit -a -m "Built files";
  git push --quiet https://$GH_TOKEN@github.com/hexcodech/booki-frontend > /dev/null 2>&1;
  fi
